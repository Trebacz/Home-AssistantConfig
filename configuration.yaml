
# Configure a default setup of Home Assistant (frontend, api, etc)
default_config:

# Uncomment this if you are using SSL/TLS, running in Docker container, etc.
# http:
#   base_url: example.duckdns.org:8123

group: !include groups.yaml
automation: !include automations.yaml
script: !include scripts.yaml
scene: !include scenes.yaml

# Text to speech
tts:
  - platform: google_translate
  
homeassistant:
  auth_mfa_modules:
    - type: totp
  unit_system: imperial

# Enable Cameras DT -3/2020
camera:
   - platform: generic
     name: front
     still_image_url: !secret Camera_URL
     stream_source: !secret CameraFront_Source 

   - platform: generic
     name: patio
     still_image_url: !secret Camera_URL
     stream_source: !secret CameraPatio_Source 

   - platform: generic
     name: frontstreet
     still_image_url: !secret Camera_URL
     stream_source: !secret CameraFrontStreet_Source 

   - platform: generic
     name: fourpeaks
     still_image_url: !secret Camera_URL
     stream_source: !secret CameraFourPeaks_Source 
    
#Enable stream
stream:

climate:
# DT 3/2020 added entry for thermostat
  - platform: honeywell
    username: !secret honeywell_username
    password: !secret honeywell_password

google_assistant:
  project_id: home-assistant-d67c1

recorder:
  db_url: !secret recorder_db_url
  
influxdb:
  host: a0d7b954-influxdb
  port: 8086
  database: homeassistant
  username: homeassistant
  password: !secret influxdb_password
  max_retries: 3
  default_measurement: state
  
twilio:
  account_sid: !secret twillio_sid
  auth_token: !secret twillio_token
  
notify:
  - name: HA_Twillio
    platform: twilio_sms
    from_number: +14805737302
    
spotify:
  client_id: !secret spotify_id
  client_secret: !secret spotify_secret

binary_sensor:
  - platform: ping
    host: 192.168.0.1
    count: 5
    scan_interval: 60
    name: Smoothwall Ping
  - platform: ping
    host: trebacz.com
    count: 5
    scan_interval: 60
    name: Trebacz Ping
  - platform: ping
    host: google.com
    count: 5
    scan_interval: 60
    name: Google Intenet Ping
  - platform: ping
    host: cam4.trebacz.com
    count: 5
    scan_interval: 60
    name: Patio Camera Ping
  - platform: template
    sensors:
      warm_inside:
        friendly_name: "Inside temperature higher than outside"
        value_template: >
          {{ float(states('sensor.average_house_temp')) >= float(states('sensor.wupws_temp')) }}
  - platform: template
    sensors:
      cool_inside:
        friendly_name: "Inside temperature cooler than outside"
        value_template: >
          {{ float(states('sensor.average_house_temp')) < float(states('sensor.wupws_temp')) }}

    # Example configuration.yaml entry
sensor:
  - platform: untappd
    username: Trebacz
    id: !secret untapped_id
    secret: !secret untapped_secret
    
  - platform: systemmonitor
    resources:
      - type: disk_use_percent
        arg: /home
      - type: memory_free
      
  - platform: min_max
    name: average_house_temp
    type: mean
    entity_ids:
      - sensor.master_bedroom_temperature
      - sensor.southbedrooms_temperature
      - sensor.water_leak_sensor_temperature_measurement
      
  - platform: template
    sensors:
      # Gets temperature from Honeywell climate
      master_bedroom_temperature:
        friendly_name: Master Bedroom Temperature
        unit_of_measurement: '°F'
        value_template: >
          {{ float(state_attr('climate.bedroom', 'current_temperature')) }}
      # Gets temperature from Honeywell climate
      southbedrooms_temperature:
        friendly_name: South Bedrooms Temperature
        unit_of_measurement: '°F'
        value_template: >
          {{ float(state_attr('climate.south_bedrooms', 'current_temperature')) }}
      # Calculates Average House Temperature
#      average_house_temp:
#        friendly_name: 'Average House Temp'
#        unit_of_measurement: "°F"
#        value_template: >
#          {{ float(((float(states('sensor.master_bedroom_temperature')) + float(states('sensor.southbedrooms_temperature'))
#          + float(states('sensor.water_leak_sensor_temperature_measurement'))) / 3) | round(1)) }}

#==================
#=== System Sensors
#==================

  - platform: command_line
    name: RPi CPU Temperature
    command: "cat /sys/class/thermal/thermal_zone0/temp"
    value_template: "{{ value | multiply(0.001) | round(2) }}"

  #===========================================
  #=== Latest Tasmota firmware version
  #===========================================
  - platform: command_line
    name: Tasmota Current Version
    command: "curl -s https://github.com/arendst/Tasmota/releases/latest | cut -d'\"' -f2 | rev | cut -d'/' -f1 | rev"
    scan_interval: 86400

  #==============================
  #=== Installed hass.io version
  #==============================
  - platform: version
    name: Installed Version
    source: local

  #================================
  #=== Latest Available HA Version
  #================================
  - platform: version
    name: Latest Available Version
    beta: false
    image: raspberrypi4
    source: hassio

  #=============================================
  #=== Last boot time, Disk, memory & CPU usage
  #=============================================
  - platform: systemmonitor
    resources:
      - type: last_boot
      - type: disk_use_percent
        arg: /
      - type: memory_use_percent
      - type: processor_use
      
# WeatherUnderground sensors
  - platform: wundergroundpws
    api_key: !secret wunderground_PWS_API_key
    pws_id: KAZFOUNT19
    latitude: 33.6075
    longitude: -111.7465
    monitored_conditions:
      - humidity
      - temp
      - dewpt
      - heatIndex
      - windChill
      - precipRate
      - precipTotal
      - pressure
      - windGust
      - windSpeed
      - weather_1d
      - weather_1n
      - weather_2d
      - weather_2n
      - weather_3d
      - weather_3n
      - weather_4d
      - weather_4n
      - weather_5d
      - weather_5n
      - temp_high_1d
      - temp_low_1d
      - wind_1d
      - precip_1d
      - precip_chance_1d
      - winddir
      - neighborhood
      - obsTimeLocal
      - stationID
      - elev
      - today_summary
    
http:
  use_x_forwarded_for: true
  trusted_proxies:
    - !secret trusted_proxy
  ip_ban_enabled: true
  login_attempts_threshold: 5
